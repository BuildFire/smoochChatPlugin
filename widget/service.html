<!DOCTYPE html>
<html>
<head>

<meta name="buildfire" content="disableTheme,disableFastClick">

    <!-- JS -->

<script src="../../../scripts/buildfire.js"></script>
    <script src="https://cdn.smooch.io/smooch.min.js"></script>
<!--
<script src="../../../scripts/angular/angular.min.js"></script>
<script src="../../../scripts/jquery/jquery-1.11.2.min.js"></script>
-->

<script>
     var smoochApp ={};

     Smooch.on('message:sent', function(message) {
         console.log('the user sent a message', message);
     });

buildfire.datastore.get('smoochChatInfo',function(err,obj){
    if(obj){
        options = obj.data;
        var initObj={};
        if(obj.data.settings.type=="Private"){
            initObj.appToken=obj.data.settings.apiKey;
            initObj.customText={headerText: obj.data.settings.headerText || "How can we help?"};
        }

        buildfire.auth.getCurrentUser(function (err, user) {
            if (user) {
                initObj.givenName = user.displayName;
                initObj.email = user.email;
            }
            if (obj && obj.instanceId) {
                initObj.userId = obj.instanceId;
            }
            initObj.userId = user._id;

            Smooch.on('message:received', function(message) {
                console.log('the user received a message', message);
            });

            Smooch.on('message:sent', function(message) {
                console.log('the user sent a message', message);
            });

            Smooch.on('message', function(message) {
                console.log('a message was added to the conversation', message);
            });

            Smooch.on('widget:opened', function() {
                console.log('Widget is opened!');
            });

            Smooch.on('widget:closed', function() {
                console.log('Widget is closed!');
            });
            smoochApp = Smooch.init(initObj);

            smoochApp.then(function(){
                Smooch.sendMessage('hello');
            })

        });
    }
});

   /*  if(smoochApp){

     }*/


/*


buildfire.datastore.onUpdate('smoochChatInfo',function(result){
   console.log(result);
})*/
</script>

</head>

</html>